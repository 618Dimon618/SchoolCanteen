{% extends 'base.html' %}
{% block content %}
<div class="dashboard">
    <h1>–ü–∞–Ω–µ–ª—å –ø–æ–≤–∞—Ä–∞</h1>

    <div class="section">
        <h2>üç≥ –ë–ª—é–¥–∞ –∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é</h2>
        {% if items_to_cook %}
        <table>
            <tr>
                <th>–ë–ª—é–¥–æ</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
            </tr>
            {% for item_id, data in items_to_cook.items() %}
            <tr>
                <td>{{ data.item.name }}</td>
                <td>{{ data.count }} —à—Ç.</td>
                <td>
                    {% for order_id in data.orders %}
                    <a href="{{ url_for('prepare_order', order_id=order_id) }}" class="btn-small">–ì–æ—Ç–æ–≤–æ #{{ order_id }}</a>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>–í—Å–µ –∑–∞–∫–∞–∑—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω—ã!</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>üì¶ –û—Å—Ç–∞—Ç–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
        <table>
            <tr>
                <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                <th>–ï–¥.</th>
            </tr>
            {% for product in products %}
            <tr class="{% if product.quantity < 10 %}low-stock{% endif %}">
                <td>{{ product.name }}</td>
                <td>{{ product.quantity }}</td>
                <td>{{ product.unit }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="section">
        <h2>üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∑–∞–∫—É–ø–∫—É</h2>
        <form method="POST" action="{{ url_for('add_request') }}" class="inline-form">
            <select name="product_id" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç</option>
                {% for product in products %}
                <option value="{{ product.id }}">{{ product.name }}</option>
                {% endfor %}
            </select>
            <input type="number" name="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" required>
            <button type="submit">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
    </div>

    <div class="section">
        <h2>üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>
        {% if my_requests %}
        <table>
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                <th>–ö–æ–ª-–≤–æ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
            {% for req in my_requests %}
            <tr>
                <td>{{ req.date.strftime('%d.%m.%Y') }}</td>
                <td>{{ req.product.name }}</td>
                <td>{{ req.quantity }}</td>
                <td>
                    {% if req.status == 'pending' %}‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                    {% elif req.status == 'approved' %}‚úÖ –û–¥–æ–±—Ä–µ–Ω–∞
                    {% else %}‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞{% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>–ó–∞—è–≤–æ–∫ –Ω–µ—Ç</p>
        {% endif %}
    </div>
</div>
{% endblock %}
